/*!
 * cropular
 * https://github.com/mattmcardle/cropper#readme
 * Version: 0.0.2 - 2016-02-17T19:44:31.044Z
 * License: ISC
 */
!function(){"use strict";var t=angular.module("cropular",[]);t.controller("CropularController",["$scope","$element","$timeout","$filter","$http","$q",function(t,e){var r=this;r.canvas=document.getElementById("canvas"),r.image=document.getElementById("attachment-image"),r.cropObject=t.cropObject,r.enableCrop=t.enableCrop,r.test=t.test,r.rect={},r.mouseX=0,r.mouseY=0,r.closeEnough=10,r.dragTL=!1,r.dragBL=!1,r.dragTR=!1,r.dragBR=!1,e.find("img").bind("load",function(){r.calculateSize(),r.crop()}),r.saveCrop=function(){t.cropObject={width:r.rect.w,height:r.rect.h,x:r.rect.startX,y:r.rect.startY,clientImageWidth:r.canvas.width,clientImageHeight:r.canvas.height}},r.calculateSize=function(){r.canvas.width=r.image.clientWidth,r.canvas.height=r.image.clientHeight,r.canvasStyle={"background-image":"url("+t.imageUrl+")","background-size":"contain"}},r.crop=function(){r.ctx=r.canvas.getContext("2d"),r.showCropControls=!0,r.editOptions=!1,r.canvas.addEventListener("mousedown",r.mouseDown,!1),r.canvas.addEventListener("mouseup",r.mouseUp,!1),r.canvas.addEventListener("mousemove",r.mouseMove,!1),r.rect={startX:r.image.clientWidth/4,startY:r.image.clientHeight/4,w:r.image.clientWidth/2,h:r.image.clientHeight/2},r.draw(),r.saveCrop()},r.mouseDown=function(t){var e=r.getPageTopLeft(r.canvas);if(r.mouseX=t.pageX-e.left,r.mouseY=t.pageY-e.top,void 0===r.rect.w)r.rect.startX=r.mouseY,r.rect.startY=r.mouseX,r.dragBR=!0;else if(r.checkCloseEnough(r.mouseX,r.rect.startX)&&r.checkCloseEnough(r.mouseY,r.rect.startY))r.dragTL=!0;else if(r.checkCloseEnough(r.mouseX,r.rect.startX+r.rect.w)&&r.checkCloseEnough(r.mouseY,r.rect.startY))r.dragTR=!0;else if(r.checkCloseEnough(r.mouseX,r.rect.startX)&&r.checkCloseEnough(r.mouseY,r.rect.startY+r.rect.h))r.dragBL=!0;else{if(!r.checkCloseEnough(r.mouseX,r.rect.startX+r.rect.w)||!r.checkCloseEnough(r.mouseY,r.rect.startY+r.rect.h))return;r.dragBR=!0}r.ctx.clearRect(0,0,r.canvas.width,r.canvas.height),r.draw()},r.checkCloseEnough=function(t,e){return Math.abs(t-e)<r.closeEnough},r.mouseUp=function(){(r.dragTL||r.dragTR||r.dragBL||r.dragBR)&&r.saveCrop(),r.dragTL=r.dragTR=r.dragBL=r.dragBR=!1},r.getPageTopLeft=function(t){var e=t.getBoundingClientRect(),r=document.documentElement;return{left:e.left+(window.pageXOffset||r.scrollLeft||0),top:e.top+(window.pageYOffset||r.scrollTop||0)}},r.mouseMove=function(t){var e=r.getPageTopLeft(r.canvas);if(r.mouseX=t.pageX-e.left,r.mouseY=t.pageY-e.top,r.dragTL)r.rect.w+=r.rect.startX-r.mouseX,r.rect.h+=r.rect.startY-r.mouseY,r.rect.startX=r.mouseX,r.rect.startY=r.mouseY;else if(r.dragTR)r.rect.w=Math.abs(r.rect.startX-r.mouseX),r.rect.h+=r.rect.startY-r.mouseY,r.rect.startY=r.mouseY;else if(r.dragBL)r.rect.w+=r.rect.startX-r.mouseX,r.rect.h=Math.abs(r.rect.startY-r.mouseY),r.rect.startX=r.mouseX;else if(r.dragBR){if(r.mouseX+50<=r.rect.startX||r.mouseY+50<r.rect.startY)return!1;r.rect.w=Math.abs(r.rect.startX-r.mouseX),r.rect.h=Math.abs(r.rect.startY-r.mouseY)}r.ctx.clearRect(0,0,r.canvas.width,r.canvas.height),r.draw()},r.draw=function(){r.rect.h<10?r.rect.h=10:r.rect.w<10&&(r.rect.w=10),r.ctx.rect(r.rect.startX,r.rect.startY,r.rect.w,r.rect.h),r.ctx.lineWidth=1,r.ctx.strokeStyle="#cccccc",r.ctx.stroke(),r.drawShadedBoxes(),r.drawHandles()},r.drawShadedBoxes=function(){r.ctx.globalAlpha=.6,r.ctx.fillStyle="#000",r.ctx.fillRect(0,0,r.rect.startX,r.canvas.height),r.ctx.fillRect(r.rect.startX+r.rect.w,0,r.canvas.width-r.rect.startX,r.canvas.height),r.ctx.fillRect(r.rect.startX,r.rect.startY+r.rect.h,r.rect.w,r.canvas.height),r.ctx.fillRect(r.rect.startX,0,r.rect.w,r.rect.startY)},r.drawHandles=function(){r.drawCircle(r.rect.startX,r.rect.startY,r.closeEnough),r.drawCircle(r.rect.startX+r.rect.w,r.rect.startY,r.closeEnough),r.drawCircle(r.rect.startX+r.rect.w,r.rect.startY+r.rect.h,r.closeEnough),r.drawCircle(r.rect.startX,r.rect.startY+r.rect.h,r.closeEnough)},r.drawCircle=function(t,e){r.ctx.fillStyle="#4cae4c",r.ctx.beginPath(),r.ctx.fillRect(t-r.closeEnough/2,e-r.closeEnough/2,r.closeEnough,r.closeEnough)}}]),t.directive("cropular",function(){return{restrict:"E",scope:{imageUrl:"=",cropObject:"=",enableCrop:"="},templateUrl:"template.html",controller:"CropularController"}})}(),angular.module("cropular").run(["$templateCache",function(t){t.put("template.html",'<div class="row"><div class="col-md-12"><img id="attachment-image" ng-bind="imageUrl" style="z-index:0;" ng-src="{{imageUrl}}" ng-show="!enableCrop" class="img-responsive"><canvas id="canvas" ng-show="enableCrop" style="background-image: url(\'{{imageUrl}}\'); background-size: contain"></canvas></div></div>')}]);