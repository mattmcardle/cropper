/*!
 * cropular
 * https://github.com/mattmcardle/cropper#readme
 * Version: 0.0.1 - 2016-02-16T13:34:44.734Z
 * License: ISC
 */
!function(){"use strict";var t=angular.module("cropular",[]);t.controller("CropularController",["$scope","$element","$timeout","$filter",function(t){var e=this;console.log(t),e.editAttachmentLoading=!1,e.canvas=document.getElementById("canvas"),e.image=document.getElementById("attachment-image"),e.url=t.imageUrl,e.editOptions=!0,e.showCropControls=!1,e.rect={},e.mouseX=0,e.mouseY=0,e.closeEnough=10,e.dragTL=!1,e.dragBL=!1,e.dragTR=!1,e.dragBR=!1,e.canvasStyle={},e.saveCrop=function(){e.editAttachmentLoading=!0;var c={width:e.rect.w,height:e.rect.h,x:e.rect.startX,y:e.rect.startY,imageWidth:e.canvas.width,imageHeight:e.canvas.height};t.cropMethod()(c)},e.crop=function(){e.ctx=e.canvas.getContext("2d"),e.showCropControls=!0,e.editOptions=!1,e.canvas.width=e.image.clientWidth,e.canvas.height=e.image.clientHeight,e.canvasStyle={"background-image":"url("+t.imageUrl+")","background-size":"contain"},e.canvas.addEventListener("mousedown",e.mouseDown,!1),e.canvas.addEventListener("mouseup",e.mouseUp,!1),e.canvas.addEventListener("mousemove",e.mouseMove,!1),console.log("here"),e.rect={startX:e.image.clientWidth/4,startY:e.image.clientHeight/4,w:e.image.clientWidth/2,h:e.image.clientHeight/2},e.draw()},e.cancelCrop=function(){e.showCropControls=!1,e.editOptions=!0},e.rotate=function(e){t.rotateMethod()(e)},e.mouseDown=function(t){var c=e.getPageTopLeft(e.canvas);if(e.mouseX=t.pageX-c.left,e.mouseY=t.pageY-c.top,console.log(e.mouseX,e.rect.startX+e.rect.w),void 0===e.rect.w)e.rect.startX=e.mouseY,e.rect.startY=e.mouseX,e.dragBR=!0;else if(e.checkCloseEnough(e.mouseX,e.rect.startX)&&e.checkCloseEnough(e.mouseY,e.rect.startY))e.dragTL=!0;else if(e.checkCloseEnough(e.mouseX,e.rect.startX+e.rect.w)&&e.checkCloseEnough(e.mouseY,e.rect.startY))e.dragTR=!0;else if(e.checkCloseEnough(e.mouseX,e.rect.startX)&&e.checkCloseEnough(e.mouseY,e.rect.startY+e.rect.h))e.dragBL=!0;else{if(!e.checkCloseEnough(e.mouseX,e.rect.startX+e.rect.w)||!e.checkCloseEnough(e.mouseY,e.rect.startY+e.rect.h))return;e.dragBR=!0}e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.draw()},e.checkCloseEnough=function(t,c){return Math.abs(t-c)<e.closeEnough},e.mouseUp=function(){e.dragTL=e.dragTR=e.dragBL=e.dragBR=!1},e.getPageTopLeft=function(t){var e=t.getBoundingClientRect(),c=document.documentElement;return{left:e.left+(window.pageXOffset||c.scrollLeft||0),top:e.top+(window.pageYOffset||c.scrollTop||0)}},e.mouseMove=function(t){var c=e.getPageTopLeft(e.canvas);if(e.mouseX=t.pageX-c.left,e.mouseY=t.pageY-c.top,e.dragTL)e.rect.w+=e.rect.startX-e.mouseX,e.rect.h+=e.rect.startY-e.mouseY,e.rect.startX=e.mouseX,e.rect.startY=e.mouseY;else if(e.dragTR)e.rect.w=Math.abs(e.rect.startX-e.mouseX),e.rect.h+=e.rect.startY-e.mouseY,e.rect.startY=e.mouseY;else if(e.dragBL)e.rect.w+=e.rect.startX-e.mouseX,e.rect.h=Math.abs(e.rect.startY-e.mouseY),e.rect.startX=e.mouseX;else if(e.dragBR){if(e.mouseX+50<=e.rect.startX||e.mouseY+50<e.rect.startY)return!1;e.rect.w=Math.abs(e.rect.startX-e.mouseX),e.rect.h=Math.abs(e.rect.startY-e.mouseY)}e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.draw()},e.draw=function(){e.rect.h<10?e.rect.h=10:e.rect.w<10&&(e.rect.w=10),e.ctx.rect(e.rect.startX,e.rect.startY,e.rect.w,e.rect.h),e.ctx.lineWidth=1,e.ctx.strokeStyle="#cccccc",e.ctx.stroke(),e.drawShadedBoxes(),e.drawHandles()},e.drawShadedBoxes=function(){e.ctx.globalAlpha=.6,e.ctx.fillStyle="#000",e.ctx.fillRect(0,0,e.rect.startX,e.canvas.height),e.ctx.fillRect(e.rect.startX+e.rect.w,0,e.canvas.width-e.rect.startX,e.canvas.height),e.ctx.fillRect(e.rect.startX,e.rect.startY+e.rect.h,e.rect.w,e.canvas.height),e.ctx.fillRect(e.rect.startX,0,e.rect.w,e.rect.startY)},e.drawHandles=function(){e.drawCircle(e.rect.startX,e.rect.startY,e.closeEnough),e.drawCircle(e.rect.startX+e.rect.w,e.rect.startY,e.closeEnough),e.drawCircle(e.rect.startX+e.rect.w,e.rect.startY+e.rect.h,e.closeEnough),e.drawCircle(e.rect.startX,e.rect.startY+e.rect.h,e.closeEnough)},e.drawCircle=function(t,c){e.ctx.fillStyle="#4cae4c",e.ctx.beginPath(),e.ctx.fillRect(t-e.closeEnough/2,c-e.closeEnough/2,e.closeEnough,e.closeEnough)}}]),t.directive("cropular",function(){return{restrict:"E",scope:{height:"@",imageUrl:"=",cropMethod:"&",rotateMethod:"&"},templateUrl:"template.html",controller:"CropularController",controllerAs:"vm"}})}(),angular.module("cropular").run(["$templateCache",function(t){t.put("template.html",'<div class="row"><div class="col-md-12"><img id="attachment-image" ng-bind="vm.image" style="z-index:0;" ng-src="{{imageUrl}}" ng-show="vm.editOptions" class="img-responsive"><canvas id="canvas" ng-show="vm.showCropControls" ng-style="vm.canvasStyle"></canvas></div></div><div class="row"><div class="col-md-12"><br><div class="btn-group" ng-show="vm.editOptions" role="group"><button type="button" ladda="vm.editAttachmentLoading" ng-click="vm.crop()" class="btn btn-default">Crop</button></div><div class="btn-group crop-controls" ng-show="vm.editOptions" role="group"><button type="button" ladda="vm.editAttachmentLoading" data-spinner-size="30" ng-click="vm.rotate(-90)" class="btn btn-default">Rotate Left</button> <button type="button" ladda="vm.editAttachmentLoading" data-spinner-size="30" ng-click="vm.rotate(90)" class="btn btn-default">Rotate Right</button></div><div class="btn-group crop-controls" ng-show="vm.showCropControls" role="group"><button type="button" ladda="vm.editAttachmentLoading" data-spinner-size="30" ng-click="vm.saveCrop()" class="btn btn-success">Save Crop</button> <button type="button" ng-click="vm.cancelCrop()" ng-disabled="vm.editAttachmentLoading" class="btn btn-default">Cancel</button></div></div></div>')}]);